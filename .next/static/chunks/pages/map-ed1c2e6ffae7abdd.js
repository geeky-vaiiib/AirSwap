(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[538],{5078:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/map",function(){return a(8617)}])},9489:function(){},3891:function(){},6013:function(){},284:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(1134).Z)("Leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]])},2602:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{default:function(){return o},noSSR:function(){return n}});let s=a(260);a(5893),a(7294);let r=s._(a(5491));function l(e){return{default:(null==e?void 0:e.default)||e}}function n(e,t){return delete t.webpack,delete t.modules,e(t)}function o(e,t){let a=r.default,s={loading:e=>{let{error:t,isLoading:a,pastDelay:s}=e;return null}};e instanceof Promise?s.loader=()=>e:"function"==typeof e?s.loader=e:"object"==typeof e&&(s={...s,...e});let o=(s={...s,...t}).loader;return(s.loadableGenerated&&(s={...s,...s.loadableGenerated},delete s.loadableGenerated),"boolean"!=typeof s.ssr||s.ssr)?a({...s,loader:()=>null!=o?o().then(l):Promise.resolve(l(()=>null))}):(delete s.webpack,delete s.modules,n(a,s))}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},1159:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"LoadableContext",{enumerable:!0,get:function(){return s}});let s=a(260)._(a(7294)).default.createContext(null)},5491:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return f}});let s=a(260)._(a(7294)),r=a(1159),l=[],n=[],o=!1;function i(e){let t=e(),a={loading:!0,loaded:null,error:null};return a.promise=t.then(e=>(a.loading=!1,a.loaded=e,e)).catch(e=>{throw a.loading=!1,a.error=e,e}),a}class d{promise(){return this._res.promise}retry(){this._clearTimeouts(),this._res=this._loadFn(this._opts.loader),this._state={pastDelay:!1,timedOut:!1};let{_res:e,_opts:t}=this;e.loading&&("number"==typeof t.delay&&(0===t.delay?this._state.pastDelay=!0:this._delay=setTimeout(()=>{this._update({pastDelay:!0})},t.delay)),"number"==typeof t.timeout&&(this._timeout=setTimeout(()=>{this._update({timedOut:!0})},t.timeout))),this._res.promise.then(()=>{this._update({}),this._clearTimeouts()}).catch(e=>{this._update({}),this._clearTimeouts()}),this._update({})}_update(e){this._state={...this._state,error:this._res.error,loaded:this._res.loaded,loading:this._res.loading,...e},this._callbacks.forEach(e=>e())}_clearTimeouts(){clearTimeout(this._delay),clearTimeout(this._timeout)}getCurrentValue(){return this._state}subscribe(e){return this._callbacks.add(e),()=>{this._callbacks.delete(e)}}constructor(e,t){this._loadFn=e,this._opts=t,this._callbacks=new Set,this._delay=null,this._timeout=null,this.retry()}}function u(e){return function(e,t){let a=Object.assign({loader:null,loading:null,delay:200,timeout:null,webpack:null,modules:null},t),l=null;function i(){if(!l){let t=new d(e,a);l={getCurrentValue:t.getCurrentValue.bind(t),subscribe:t.subscribe.bind(t),retry:t.retry.bind(t),promise:t.promise.bind(t)}}return l.promise()}if(!o){let e=a.webpack?a.webpack():a.modules;e&&n.push(t=>{for(let a of e)if(t.includes(a))return i()})}function u(e,t){!function(){i();let e=s.default.useContext(r.LoadableContext);e&&Array.isArray(a.modules)&&a.modules.forEach(t=>{e(t)})}();let n=s.default.useSyncExternalStore(l.subscribe,l.getCurrentValue,l.getCurrentValue);return s.default.useImperativeHandle(t,()=>({retry:l.retry}),[]),s.default.useMemo(()=>{var t;return n.loading||n.error?s.default.createElement(a.loading,{isLoading:n.loading,pastDelay:n.pastDelay,timedOut:n.timedOut,error:n.error,retry:l.retry}):n.loaded?s.default.createElement((t=n.loaded)&&t.default?t.default:t,e):null},[e,n])}return u.preload=()=>i(),u.displayName="LoadableComponent",s.default.forwardRef(u)}(i,e)}function c(e,t){let a=[];for(;e.length;){let s=e.pop();a.push(s(t))}return Promise.all(a).then(()=>{if(e.length)return c(e,t)})}u.preloadAll=()=>new Promise((e,t)=>{c(l).then(e,t)}),u.preloadReady=e=>(void 0===e&&(e=[]),new Promise(t=>{let a=()=>(o=!0,t());c(n,e).then(a,a)})),window.__NEXT_PRELOADREADY=u.preloadReady;let f=u},8617:function(e,t,a){"use strict";a.r(t),a.d(t,{__N_SSP:function(){return w},default:function(){return v}});var s=a(5893),r=a(7294),l=a(1891),n=a(284),o=a(1134);let i=(0,o.Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),d=(0,o.Z)("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);var u=a(1664),c=a.n(u),f=a(5152),m=a.n(f),h=a(6013),p=a(9489),y=a.n(p),x=a(3891),b=a.n(x),_=a(6731);let g=m()(()=>a.e(823).then(a.t.bind(a,6823,23)),{loadableGenerated:{webpack:()=>[6823]},ssr:!1,loading:()=>(0,s.jsx)("div",{className:"h-full w-full flex items-center justify-center bg-sand",children:(0,s.jsxs)("div",{className:"text-center space-y-4",children:[(0,s.jsx)(l.E.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},className:"w-12 h-12 rounded-xl bg-forest/10 flex items-center justify-center mx-auto",children:(0,s.jsx)(n.Z,{className:"w-6 h-6 text-forest"})}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Loading map..."})]})})}),j=async()=>{let e=await fetch("/api/ndvi-check");if(!e.ok)throw Error("Failed to fetch NDVI data");let t=await e.json();return{...t,beforeImage:t.beforeImage.startsWith("http")?t.beforeImage:"https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=400&h=400&fit=crop",afterImage:t.afterImage.startsWith("http")?t.afterImage:"https://images.unsplash.com/photo-1518173946687-a4c036bc8d7c?w=400&h=400&fit=crop"}};var w=!0,v=()=>{let[e,t]=(0,r.useState)("select"),[a,o]=(0,r.useState)(!1),[u,f]=(0,r.useState)(null),[m,p]=(0,r.useState)(!1),[x,w]=(0,r.useState)(!1),v=async e=>{p(!0),o(!0),w(!0),t("select");try{let e=await j();f(e),(0,_.Am)({title:"Analysis Complete",description:"NDVI change detected: +".concat(e.ndviDelta,"%")})}catch(e){(0,_.Am)({title:"Error",description:"Failed to analyze the selected area",variant:"destructive"})}finally{p(!1)}};return(0,s.jsxs)("div",{className:"h-screen w-screen bg-sand overflow-hidden relative",children:[(0,s.jsxs)(l.E.div,{initial:{y:-20,opacity:0},animate:{y:0,opacity:1},className:"absolute top-4 left-4 right-4 z-20 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"glass rounded-2xl px-4 py-3 flex items-center gap-4",children:[(0,s.jsxs)(c(),{href:"/",className:"flex items-center gap-2 group",children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-forest to-emerald flex items-center justify-center",children:(0,s.jsx)(n.Z,{className:"w-5 h-5 text-teal"})}),(0,s.jsx)("span",{className:"font-display text-lg font-bold text-forest",children:"AirSwap"})]}),(0,s.jsx)("div",{className:"w-px h-8 bg-border"}),(0,s.jsx)(c(),{href:"/",children:(0,s.jsxs)(h.Button,{variant:"ghost",size:"sm",children:[(0,s.jsx)(i,{className:"w-4 h-4 mr-2"}),"Back"]})})]}),(0,s.jsxs)("div",{className:"glass rounded-2xl px-4 py-3 flex items-center gap-2",children:[(0,s.jsx)(d,{className:"w-4 h-4 text-muted-foreground"}),(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"polygon"===e?"Click to draw points, double-click to complete":"Select 'Draw Polygon' to start"})]})]}),(0,s.jsxs)("div",{className:"h-full w-full relative",children:[(0,s.jsx)(r.Suspense,{fallback:(0,s.jsx)("div",{className:"h-full w-full flex items-center justify-center bg-sand",children:(0,s.jsxs)("div",{className:"text-center space-y-4",children:[(0,s.jsx)(l.E.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},className:"w-12 h-12 rounded-xl bg-forest/10 flex items-center justify-center mx-auto",children:(0,s.jsx)(n.Z,{className:"w-6 h-6 text-forest"})}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Loading map..."})]})}),children:(0,s.jsx)(g,{onPolygonComplete:v,drawEnabled:"polygon"===e})}),m&&(0,s.jsx)(l.E.div,{initial:{opacity:0},animate:{opacity:1},className:"absolute inset-0 bg-forest/20 backdrop-blur-sm flex items-center justify-center z-30",children:(0,s.jsxs)("div",{className:"glass rounded-2xl p-8 text-center",children:[(0,s.jsx)(l.E.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},className:"w-16 h-16 rounded-xl bg-teal/20 flex items-center justify-center mx-auto mb-4",children:(0,s.jsx)(n.Z,{className:"w-8 h-8 text-teal"})}),(0,s.jsx)("p",{className:"font-medium text-forest",children:"Analyzing satellite data..."})]})}),(0,s.jsx)(b(),{isOpen:a,onClose:()=>o(!1),ndviData:u,onIssueCredit:()=>{(0,_.Am)({title:"Credit Issued! \uD83C\uDF89",description:"847 Oxygen Credits have been added to your account (Demo)"})}})]}),(0,s.jsx)(y(),{activeTool:e,onToolChange:t,onClear:()=>{f(null),o(!1),w(!1),window.location.reload()},canClear:x})]})}},6731:function(e,t,a){"use strict";a.d(t,{Am:function(){return u}}),a(7294);let s=0,r=new Map,l=e=>{if(r.has(e))return;let t=setTimeout(()=>{r.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);r.set(e,t)},n=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?l(a):e.toasts.forEach(e=>{l(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},o=[],i={toasts:[]};function d(e){i=n(i,e),o.forEach(e=>{e(i)})}function u(e){let{...t}=e,a=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>d({type:"DISMISS_TOAST",toastId:a});return d({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||r()}}}),{id:a,dismiss:r,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:a}})}}},5152:function(e,t,a){e.exports=a(2602)}},function(e){e.O(0,[913,664,888,774,179],function(){return e(e.s=5078)}),_N_E=e.O()}]);